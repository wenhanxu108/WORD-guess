<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»ˆæå•è¯çŒœæƒ³åŠ©æ‰‹ (37w+ æµ·é‡è¯åº“)</title>
    <style>
        :root {
            --primary-color: #2980b9;
            --secondary-color: #2c3e50;
            --bg-color: #f0f2f5;
            --panel-bg: #ffffff;
            --success-color: #27ae60;
            --danger-color: #c0392b;
            --warning-color: #d35400;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--secondary-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        h1 { margin-bottom: 5px; color: var(--secondary-color); }
        .subtitle { font-size: 0.9em; color: #7f8c8d; margin-bottom: 25px; }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--panel-bg);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
        }

        .section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ebedef;
        }
        .section:last-child { border-bottom: none; padding-bottom: 0; }
        
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-weight: 700;
            color: #34495e;
            font-size: 1.1em;
        }
        .step-badge {
            background: var(--secondary-color);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 0.8em;
        }

        /* 1. é•¿åº¦æ»‘å— */
        .length-control {
            display: flex;
            align-items: center;
            gap: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        input[type="range"] { flex-grow: 1; cursor: pointer; height: 8px; border-radius: 5px; accent-color: var(--primary-color); }
        .length-display {
            background: var(--primary-color);
            color: white;
            padding: 8px 18px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2em;
            min-width: 30px;
            text-align: center;
        }

        /* 2. è¾“å…¥æ¡†åŒºåŸŸ */
        .input-group {
            display: flex;
            gap: 25px;
        }
        @media (max-width: 650px) { .input-group { flex-direction: column; gap: 15px; } }
        
        .input-box { flex: 1; position: relative; }
        .input-box label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9em; }
        .input-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 3px;
            box-sizing: border-box; 
            transition: all 0.3s;
        }
        .input-box input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(41, 128, 185, 0.1); }
        
        /* é¢œè‰²åŒºåˆ† */
        .input-box.pool label { color: var(--warning-color); }
        .input-box.pool input:focus { border-color: var(--warning-color); box-shadow: 0 0 0 3px rgba(211, 84, 0, 0.1); }
        .input-box.must label { color: var(--success-color); }
        .input-box.must input:focus { border-color: var(--success-color); box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1); }

        /* 3. æ’é™¤åŒºåŸŸ (Exclude) */
        .exclude-container {
            background: #fff5f5;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ffecec;
        }
        .exclude-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(32px, 1fr));
            gap: 8px;
        }
        .exclude-btn {
            background: white;
            border: 1px solid #eecbcb;
            color: #c0392b;
            padding: 10px 0;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.15s;
            text-transform: uppercase;
            text-align: center;
            font-size: 1.1em;
        }
        .exclude-btn:hover { background: #ffebeb; transform: translateY(-1px); }
        
        /* é€‰ä¸­æ’é™¤çš„çŠ¶æ€ */
        .exclude-btn.banned {
            background-color: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
            opacity: 0.9;
        }

        /* è¾…åŠ©é”®ç›˜ */
        .keyboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(30px, 1fr));
            gap: 6px;
            margin-top: 15px;
            background: #eaf2f8;
            padding: 10px;
            border-radius: 8px;
        }
        .key-btn {
            background: white;
            border: 1px solid #d6eaf8;
            padding: 8px 0;
            border-radius: 4px;
            cursor: pointer;
            color: var(--primary-color);
            font-weight: 600;
            transition: all 0.1s;
        }
        .key-btn:hover { background: var(--primary-color); color: white; }

        /* ç»“æœåŒºåŸŸ */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        #wordList {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 5px;
        }
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        #wordList::-webkit-scrollbar { width: 8px; }
        #wordList::-webkit-scrollbar-track { background: #f1f1f1; }
        #wordList::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        .word-tag {
            background: white;
            border: 1px solid #bdc3c7;
            color: #34495e;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            font-family: 'Courier New', Courier, monospace; /* ç­‰å®½å­—ä½“çœ‹å­—æ¯æ›´æ¸…æ¥š */
            font-weight: bold;
        }
        .word-tag:hover { background: var(--secondary-color); color: white; border-color: var(--secondary-color); transform: scale(1.05); }
        
        .loading { 
            color: #7f8c8d; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-style: italic;
        }
        .status-badge {
            font-size: 0.8em;
            padding: 4px 10px;
            border-radius: 12px;
            background: #e0e0e0;
            color: #555;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .spinner {
            width: 16px; height: 16px;
            border: 3px solid #ccc;
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <h1>ç»ˆæå•è¯çŒœæƒ³åŠ©æ‰‹</h1>
    <div class="subtitle">å½“å‰åŠ è½½è¯åº“: <span id="dictStatus" style="font-weight:bold;">è¿æ¥ä¸­...</span></div>

    <div class="container">
        
        <div class="section">
            <div class="section-header">
                <div class="step-badge">1</div>
                <span>è®¾å®šå•è¯å­—æ•°</span>
            </div>
            <div class="length-control">
                <input type="range" id="lengthSlider" min="2" max="20" value="5">
                <span id="lengthDisplay" class="length-display">5</span>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <div class="step-badge">2</div>
                <span>è¾“å…¥å·²çŸ¥ä¿¡æ¯</span>
            </div>
            <div class="input-group">
                <div class="input-box pool">
                    <label>âšª å­—æ¯æ±  (Available)</label>
                    <input type="text" id="possibleInput" placeholder="è¾“å…¥ä½ æœ‰çš„æ‰€æœ‰å­—æ¯..." onfocus="setActiveInput('possibleInput')">
                </div>
                <div class="input-box must">
                    <label>ğŸŸ¢ å¿…å«å­—æ¯ (Must Have)</label>
                    <input type="text" id="existingInput" placeholder="è¾“å…¥ç¡®å®šå­˜åœ¨çš„å­—æ¯..." onfocus="setActiveInput('existingInput')">
                </div>
            </div>
            <div class="keyboard-grid" id="inputKeyboard">
                </div>
            <div style="text-align:center; margin-top:5px; font-size:0.8em; color:#999;">ç‚¹å‡»ä¸Šæ–¹é”®ç›˜å°†å­—æ¯è¾“å…¥åˆ°é€‰ä¸­çš„æ¡†ä¸­</div>
        </div>

        <div class="section">
            <div class="section-header">
                <div class="step-badge" style="background:var(--danger-color)">3</div>
                <span>æ’é™¤å­—æ¯ (ç‚¹å‡»å˜çº¢ = ç»å¯¹ä¸å«)</span>
            </div>
            <div class="exclude-container">
                <div class="exclude-grid" id="excludeKeyboard">
                    </div>
            </div>
        </div>

        <div class="section" style="border:none; padding-bottom:0;">
            <div class="results-header">
                <div class="section-header" style="margin:0;">
                    <div class="step-badge" style="background:var(--success-color)">4</div>
                    <span>åŒ¹é…ç»“æœ</span>
                </div>
                <span class="status-badge" id="matchCount">...</span>
            </div>
            <div id="wordList">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>æ­£åœ¨ä» GitHub ä¸‹è½½ 370,000 è¯åº“ (çº¦ 3MB)ï¼Œè¯·ç¨å€™...</span>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- æ ¸å¿ƒæ•°æ® ---
    let dictionary = []; // å­˜æ”¾å•è¯
    let excludedSet = new Set(); // å­˜æ”¾è¢«æ’é™¤çš„å­—æ¯
    let activeInputId = 'possibleInput'; // å½“å‰å…‰æ ‡æ‰€åœ¨çš„è¾“å…¥æ¡†

    // --- DOM å…ƒç´  ---
    const slider = document.getElementById('lengthSlider');
    const lengthDisplay = document.getElementById('lengthDisplay');
    const possibleInput = document.getElementById('possibleInput');
    const existingInput = document.getElementById('existingInput');
    const excludeKeyboard = document.getElementById('excludeKeyboard');
    const inputKeyboard = document.getElementById('inputKeyboard');
    const wordList = document.getElementById('wordList');
    const matchCount = document.getElementById('matchCount');
    const dictStatus = document.getElementById('dictStatus');

    // --- 1. åˆå§‹åŒ–åŠ è½½æµ·é‡è¯åº“ ---
    // ä½¿ç”¨ dwyl/english-words çš„ alpha listï¼ŒåŒ…å«çº¦ 370,000 ä¸ªå•è¯
    const DICT_URL = 'https://raw.githubusercontent.com/dwyl/english-words/master/words_alpha.txt';

    async function loadDictionary() {
        try {
            const response = await fetch(DICT_URL);
            if (!response.ok) throw new Error("Network response was not ok");
            const text = await response.text();
            
            // æŒ‰è¡Œåˆ†å‰²ï¼Œå¤„ç† Windows/Unix æ¢è¡Œç¬¦
            dictionary = text.split(/\r?\n/);
            
            // ç®€å•æ¸…æ´—ï¼Œç§»é™¤ç©ºè¡Œ
            dictionary = dictionary.filter(w => w.length > 0);

            dictStatus.textContent = `${dictionary.length.toLocaleString()} è¯ (Ready)`;
            dictStatus.style.color = '#27ae60';
            
            updateResults(); // åŠ è½½å®Œæ¯•åç«‹å³è®¡ç®—
        } catch (error) {
            console.error("è¯åº“åŠ è½½å¤±è´¥:", error);
            dictStatus.textContent = "åŠ è½½å¤±è´¥ (ä½¿ç”¨ç¦»çº¿å¤‡ç”¨åº“)";
            dictStatus.style.color = '#c0392b';
            // å¤‡ç”¨å°è¯åº“é˜²æ­¢é¡µé¢å®Œå…¨ä¸å¯ç”¨
            dictionary = ["apple", "banana", "cherry", "date", "elderberry", "fig", "grape", "error", "network", "fail"];
            updateResults();
        }
    }

    // å¯åŠ¨åŠ è½½
    loadDictionary();

    // --- 2. ç•Œé¢ç”Ÿæˆ ---
    const letters = 'abcdefghijklmnopqrstuvwxyz'.split('');

    // A. ç”Ÿæˆæ’é™¤é”®ç›˜ (çº¢è‰²)
    letters.forEach(char => {
        const btn = document.createElement('div');
        btn.className = 'exclude-btn';
        btn.textContent = char;
        btn.onclick = () => toggleExclude(btn, char);
        excludeKeyboard.appendChild(btn);
    });

    // B. ç”Ÿæˆè¾“å…¥è¾…åŠ©é”®ç›˜ (è“è‰²)
    letters.forEach(char => {
        const btn = document.createElement('button');
        btn.className = 'key-btn';
        btn.textContent = char;
        btn.onclick = () => addLetterToInput(char);
        inputKeyboard.appendChild(btn);
    });

    // --- 3. äº¤äº’é€»è¾‘ ---

    window.setActiveInput = (id) => {
        activeInputId = id;
    };

    function addLetterToInput(char) {
        const input = document.getElementById(activeInputId);
        input.value += char;
        input.focus();
        updateResults(); // å®æ—¶è§¦å‘
    }

    function toggleExclude(btnElement, char) {
        if (excludedSet.has(char)) {
            excludedSet.delete(char);
            btnElement.classList.remove('banned');
        } else {
            excludedSet.add(char);
            btnElement.classList.add('banned');
        }
        updateResults(); // å®æ—¶è§¦å‘
    }

    // --- 4. ç­›é€‰æ ¸å¿ƒç®—æ³• ---
    function updateResults() {
        if (dictionary.length === 0) return;

        const targetLength = parseInt(slider.value);
        const poolChars = possibleInput.value.toLowerCase(); 
        const mustChars = existingInput.value.toLowerCase();
        
        // æ€§èƒ½ä¼˜åŒ–ï¼šå…ˆè¿‡æ»¤é•¿åº¦ï¼Œå¤§å¹…å‡å°åç»­å¾ªç¯æ¬¡æ•°
        // ç”±äºè¯åº“å¾ˆå¤§ï¼Œæˆ‘ä»¬åªéå†ä¸€æ¬¡
        const matches = [];
        
        for (let i = 0; i < dictionary.length; i++) {
            const word = dictionary[i];
            
            // A. é•¿åº¦æ£€æŸ¥ (æœ€å¿«)
            if (word.length !== targetLength) continue;

            // B. æ’é™¤æ£€æŸ¥ (è¾ƒå¿«)
            let isExcluded = false;
            for (let j = 0; j < word.length; j++) {
                if (excludedSet.has(word[j])) {
                    isExcluded = true;
                    break;
                }
            }
            if (isExcluded) continue;

            // C. å¿…å«å­—æ¯æ£€æŸ¥
            if (mustChars.length > 0) {
                let hasAllMusts = true;
                for (let j = 0; j < mustChars.length; j++) {
                    if (!word.includes(mustChars[j])) {
                        hasAllMusts = false;
                        break;
                    }
                }
                if (!hasAllMusts) continue;
            }

            // D. å­—æ¯æ± æ£€æŸ¥
            if (poolChars.length > 0) {
                let fromPool = true;
                for (let j = 0; j < word.length; j++) {
                    if (!poolChars.includes(word[j])) {
                        fromPool = false;
                        break;
                    }
                }
                if (!fromPool) continue;
            }

            // é€šè¿‡æ‰€æœ‰æ£€æŸ¥
            matches.push(word);

            // ä¿æŠ¤æœºåˆ¶ï¼šå¦‚æœåŒ¹é…æ•°é‡å¤ªå¤šï¼ˆä¾‹å¦‚ > 500ï¼‰ï¼Œä¸ºäº†ä¸å¡æ­» DOMï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¸²æŸ“é˜¶æ®µæˆªæ–­
            // ä½†ä¸ºäº†ç»Ÿè®¡å‡†ç¡®ï¼Œè¿™é‡Œæˆ‘ä»¬æ”¶é›†æ‰€æœ‰ï¼Œä½†åœ¨ render æ—¶é™åˆ¶
        }

        renderList(matches);
    }

    // --- 5. æ¸²æŸ“åˆ—è¡¨ ---
    function renderList(words) {
        wordList.innerHTML = '';
        matchCount.textContent = `${words.length} ä¸ªç»“æœ`;

        if (words.length === 0) {
            wordList.innerHTML = '<div style="color:#999; width:100%; text-align:center; padding:20px;">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å•è¯</div>';
            return;
        }

        // é™åˆ¶æ˜¾ç¤ºæ•°é‡ï¼Œé˜²æ­¢æµè§ˆå™¨å´©æºƒ
        const LIMIT = 300;
        const displayWords = words.slice(0, LIMIT);

        displayWords.forEach(word => {
            const tag = document.createElement('span');
            tag.className = 'word-tag';
            tag.textContent = word;
            tag.onclick = () => {
                navigator.clipboard.writeText(word);
                // é—ªçƒæ•ˆæœ
                const originalBg = tag.style.background;
                tag.style.background = '#27ae60';
                tag.style.color = 'white';
                tag.textContent = 'å·²å¤åˆ¶!';
                setTimeout(() => {
                    tag.style.background = originalBg;
                    tag.style.color = '';
                    tag.textContent = word;
                }, 600);
            };
            wordList.appendChild(tag);
        });

        if (words.length > LIMIT) {
            const warning = document.createElement('div');
            warning.style.width = '100%';
            warning.style.textAlign = 'center';
            warning.style.padding = '10px';
            warning.style.color = '#e67e22';
            warning.style.fontWeight = 'bold';
            warning.textContent = `âš ï¸ ç»“æœå¤ªå¤š (${words.length} ä¸ª)ï¼Œä»…æ˜¾ç¤ºå‰ ${LIMIT} ä¸ªã€‚è¯·å°è¯•å¢åŠ æ›´å¤šç­›é€‰æ¡ä»¶ï¼ˆå¦‚æ’é™¤å­—æ¯ï¼‰ã€‚`;
            wordList.appendChild(warning);
        }
    }

    // --- 6. äº‹ä»¶ç›‘å¬ ---
    slider.addEventListener('input', (e) => {
        lengthDisplay.textContent = e.target.value;
        updateResults();
    });

    possibleInput.addEventListener('input', updateResults);
    existingInput.addEventListener('input', updateResults);

</script>

</body>
</html>